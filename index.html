<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>–ê–ó–•–£–†</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#000000">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
html,body{height:100%}
body{
  background:radial-gradient(circle at top,#2b1055,#000);
  color:#eaffff;
  overflow:hidden;
  touch-action:none;
}
#score{
  position:fixed;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  font-size:22px;
  z-index:10;
}
.screen{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.85);
  z-index:20;
}
.hidden{display:none}
h1{
  font-size:48px;
  letter-spacing:6px;
  background:linear-gradient(90deg,#00ffd5,#ffd700,#ff4d6d);
  -webkit-background-clip:text;
  color:transparent;
}
button{
  margin-top:24px;
  padding:14px 36px;
  border:none;
  border-radius:40px;
  font-weight:700;
  background:linear-gradient(90deg,#00ffd5,#ffd700);
}
canvas{display:block}
</style>
</head>

<body>

<div id="score">0</div>

<div id="menu" class="screen">
  <h1>–ê–ó–•–£–†</h1>
  <button onclick="showTutorial()">–≠–•–õ–≠–•</button>
</div>

<div id="tutorial" class="screen hidden">
  <h1>–ó–ê–ê–í–ê–†</h1>
  <p>üëÜ –¢–æ–≤—à ‚Üí —á–∏–≥ —Å–æ–ª–∏–≥–¥–æ–Ω–æ</p>
  <p>üé® ”®–Ω–≥”© —Å–æ–ª–∏–≥–¥–æ–Ω–æ</p>
  <p>‚úåÔ∏è 2 —Ö—É—Ä—É—É ‚Üí Pause</p>
  <button onclick="startGame()">–¢–û–ì–õ–û–Å</button>
</div>

<div id="pause" class="screen hidden">
  <h1>PAUSE</h1>
  <button onclick="resume()">“Æ–†–ì–≠–õ–ñ–õ“Æ“Æ–õ–≠–•</button>
</div>

<div id="over" class="screen hidden">
  <h1>–¢”®–ì–°”®–í</h1>
  <p id="final"></p>
  <p id="best"></p>
  <button onclick="backToMenu()">–ë–£–¶–ê–•</button>
</div>

<canvas id="game"></canvas>

<script>
/* ---------- Canvas ---------- */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

/* ---------- Audio ---------- */
const AC=window.AudioContext||window.webkitAudioContext;
const audio=new AC();
function beep(f=600,d=0.1){
  const o=audio.createOscillator();
  const g=audio.createGain();
  o.frequency.value=f;
  g.gain.value=0.15;
  o.connect(g);g.connect(audio.destination);
  o.start();o.stop(audio.currentTime+d);
}

/* ---------- State ---------- */
let gameState="menu";
const colors=["#00ffd5","#ffd700","#ff4d6d","#4dabff","#c77dff"];
let player,obs,parts,score,speed,timer;

/* ---------- Init ---------- */
function init(){
  player={x:canvas.width/2,y:canvas.height-120,r:16,dir:1};
  obs=[];parts=[];
  score=0;
  speed=3;
  document.getElementById("score").textContent=0;
}

/* ---------- Flow ---------- */
function showTutorial(){
  gameState="tutorial";
  menu.classList.add("hidden");
  tutorial.classList.remove("hidden");
}

function startGame(){
  tutorial.classList.add("hidden");
  gameState="play";
  init();
  timer=setInterval(spawn,600);
}

function backToMenu(){
  over.classList.add("hidden");
  menu.classList.remove("hidden");
  gameState="menu";
}

function resume(){
  pause.classList.add("hidden");
  gameState="play";
}

/* ---------- Input ---------- */
let pointers=0;
addEventListener("pointerdown",()=>{
  pointers++;
  if(gameState!=="play")return;

  if(pointers>=2){
    gameState="pause";
    pause.classList.remove("hidden");
    return;
  }
  player.dir*=-1;
  beep(700);
});
addEventListener("pointerup",()=>pointers=Math.max(0,pointers-1));

/* ---------- Spawn ---------- */
function spawn(){
  if(gameState!=="play")return;
  obs.push({x:Math.random()*canvas.width,y:-20,r:14});
}

/* ---------- Loop ---------- */
function loop(){
  requestAnimationFrame(loop);
  if(gameState!=="play")return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // movement
  if(player.x<=player.r) player.dir=1;
  if(player.x>=canvas.width-player.r) player.dir=-1;
  player.x+=player.dir*4.5;

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle=colors[score%colors.length];
  ctx.fill();

  for(let o of obs){
    o.y+=speed;
    ctx.beginPath();
    ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
    ctx.fillStyle="#fff";
    ctx.fill();
    if(Math.hypot(o.x-player.x,o.y-player.y)<o.r+player.r){
      endGame(); return;
    }
  }
  obs=obs.filter(o=>o.y<canvas.height+40);

  score++;
  speed+=0.0007;
  document.getElementById("score").textContent=score;
}

/* ---------- End ---------- */
function endGame(){
  gameState="over";
  clearInterval(timer);
  navigator.vibrate?.([80,40,80]);
  beep(180,0.3);

  let best=+localStorage.getItem("az_best")||0;
  if(score>best){best=score;localStorage.setItem("az_best",best);}
  final.textContent="–û–Ω–æ–æ: "+score;
  bestEl.textContent="–®–∏–ª–¥—ç–≥: "+best;
  over.classList.remove("hidden");
}

/* ---------- Start loop ---------- */
loop();
</script>

</body>
</html>
