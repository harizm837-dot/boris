<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>–ê–ó–•–£–†</title>

<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#000000">

<style>
:root{--text:#eaffff}
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
html,body{height:100%}

body{
  background:radial-gradient(circle at top,#2b1055,#000);
  overflow:hidden;
  color:var(--text);
  touch-action:none;
  user-select:none;
}

#score{
  position:fixed;
  top:env(safe-area-inset-top,14px);
  left:50%;
  transform:translateX(-50%);
  font-size:22px;
  z-index:10;
}

.screen{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(180deg,rgba(0,0,0,.4),rgba(0,0,0,.92));
  backdrop-filter:blur(6px);
  z-index:20;
  text-align:center;
}
.hidden{display:none}

h1{
  font-size:48px;
  letter-spacing:6px;
  background:linear-gradient(90deg,#00ffd5,#ffd700,#ff4d6d);
  -webkit-background-clip:text;
  color:transparent;
}

button{
  margin-top:22px;
  padding:14px 36px;
  border:none;
  border-radius:36px;
  font-size:16px;
  font-weight:700;
  background:linear-gradient(90deg,#00ffd5,#ffd700);
  color:#001;
  box-shadow:0 0 30px rgba(0,255,213,.6);
}
button:active{transform:scale(.95)}

.skin{
  margin-top:12px;
  opacity:.85;
  font-size:14px;
}

canvas{display:block}
</style>
</head>

<body>

<div id="score">0</div>

<!-- START -->
<div id="start" class="screen">
  <h1>–ê–ó–•–£–†</h1>
  <p>–ù—ç–≥ —Ç–æ–≤—à–∏–ª—Ç ¬∑ –ù—ç–≥ –∞–º—å</p>
  <div class="skin" id="skinName"></div>
  <button onclick="startGame()">–≠–•–õ–≠–•</button>
</div>

<!-- TUTORIAL -->
<div id="tutorial" class="screen hidden">
  <h1>–¢–û–ì–õ–û–• –ó–ê–ê–í–ê–†</h1>
  <p>üëÜ –ù—ç–≥ —Ç–æ–≤—à ‚Üí —á–∏–≥ —Å–æ–ª–∏–≥–¥–æ–Ω–æ</p>
  <p>üé® ”®–Ω–≥”© ”©”©—Ä—á–ª”©–≥–¥”©–Ω”©</p>
  <p>‚úåÔ∏è 2 —Ö—É—Ä—É—É ‚Üí Pause</p>
  <button onclick="closeTutorial()">–û–ô–õ–ì–û–õ–û–û</button>
</div>

<!-- PAUSE -->
<div id="pause" class="screen hidden">
  <h1>PAUSE</h1>
  <button onclick="resume()">“Æ–†–ì–≠–õ–ñ–õ“Æ“Æ–õ–≠–•</button>
</div>

<!-- GAME OVER -->
<div id="over" class="screen hidden">
  <h1>–¢”®–ì–°”®–í</h1>
  <p id="final"></p>
  <p id="best"></p>
  <button onclick="restart()">–î–ê–•–ò–ù</button>
</div>

<canvas id="game"></canvas>

<script>
/* ---------- Canvas ---------- */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize();addEventListener("resize",resize);
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}

/* ---------- Skins ---------- */
const skins=[
 {name:"DEFAULT",score:0,colors:["#00ffd5","#ffd700","#ff4d6d"]},
 {name:"NEON",score:500,colors:["#00ffea","#ff00ff","#00ff00"]},
 {name:"VOID",score:1500,colors:["#7b2cbf","#3c096c","#240046"]},
 {name:"GOLD",score:3000,colors:["#ffd700","#ffb703","#fb8500"]}
];

let unlocked=JSON.parse(localStorage.getItem("az_skins"))||[0];
let currentSkin=unlocked[unlocked.length-1]||0;
document.getElementById("skinName").textContent="Skin: "+skins[currentSkin].name;

/* ---------- Game State ---------- */
let player,obs,parts,score,speed,alive,paused,timer;
let colors=skins[currentSkin].colors;

/* ---------- Tutorial ---------- */
const firstTime=!localStorage.getItem("az_played");

/* ---------- Init ---------- */
function init(){
  player={x:canvas.width/2,y:canvas.height-120,r:16,dir:1,color:0};
  obs=[];parts=[];
  score=0;
  speed=3;
  alive=true;
  paused=false;
}

/* ---------- Start ---------- */
function startGame(){
  document.getElementById("start").classList.add("hidden");

  if(firstTime){
    document.getElementById("tutorial").classList.remove("hidden");
    localStorage.setItem("az_played",1);
    return;
  }

  init();
  timer=setInterval(spawn,550);
  loop();
}

function closeTutorial(){
  document.getElementById("tutorial").classList.add("hidden");
  init();
  timer=setInterval(spawn,550);
  loop();
}

/* ---------- Controls ---------- */
let pointers=new Set();

addEventListener("pointerdown",e=>{
  pointers.add(e.pointerId);
  if(!alive||paused)return;

  if(pointers.size>=2){pause();return;}

  player.dir*=-1;
  player.color=(player.color+1)%colors.length;
  burst(player.x,player.y);
});

addEventListener("pointerup",e=>pointers.delete(e.pointerId));
addEventListener("pointercancel",e=>pointers.delete(e.pointerId));

/* ---------- Spawn ---------- */
function spawn(){
  if(paused)return;
  obs.push({
    x:Math.random()*canvas.width,
    y:-30,
    r:14,
    c:colors[Math.random()*colors.length|0]
  });
}

/* ---------- FX ---------- */
function burst(x,y){
  for(let i=0;i<14;i++){
    parts.push({
      x,y,
      vx:(Math.random()-.5)*6,
      vy:(Math.random()-.5)*6,
      life:30,
      c:colors[Math.random()*colors.length|0]
    });
  }
}

/* ---------- Loop ---------- */
function loop(){
  if(!alive)return;
  if(paused){requestAnimationFrame(loop);return;}

  ctx.clearRect(0,0,canvas.width,canvas.height);

  player.x+=player.dir*4.5;
  if(player.x<player.r||player.x>canvas.width-player.r)player.dir*=-1;

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle=colors[player.color];
  ctx.shadowBlur=25;
  ctx.shadowColor=colors[player.color];
  ctx.fill();
  ctx.shadowBlur=0;

  for(let o of obs){
    o.y+=speed;
    ctx.beginPath();
    ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
    ctx.fillStyle=o.c;
    ctx.fill();

    if(Math.hypot(o.x-player.x,o.y-player.y)<o.r+player.r){
      end();return;
    }
  }
  obs=obs.filter(o=>o.y<canvas.height+40);

  for(let p of parts){
    p.x+=p.vx;p.y+=p.vy;p.life--;
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,3,3);
  }
  parts=parts.filter(p=>p.life>0);

  score++;
  speed+=0.0008;
  document.getElementById("score").textContent=score;

  requestAnimationFrame(loop);
}

/* ---------- Pause ---------- */
function pause(){
  if(paused||!alive)return;
  paused=true;
  document.getElementById("pause").classList.remove("hidden");
}
function resume(){
  paused=false;
  document.getElementById("pause").classList.add("hidden");
}
addEventListener("visibilitychange",()=>{
  if(document.hidden && alive && !paused)pause();
});

/* ---------- End ---------- */
function end(){
  alive=false;
  clearInterval(timer);

  let best=+localStorage.getItem("az_best")||0;
  if(score>best){best=score;localStorage.setItem("az_best",best);}

  skins.forEach((s,i)=>{
    if(score>=s.score && !unlocked.includes(i)){
      unlocked.push(i);
      localStorage.setItem("az_skins",JSON.stringify(unlocked));
      currentSkin=i;
      colors=s.colors;
    }
  });

  document.getElementById("final").textContent="–û–Ω–æ–æ: "+score;
  document.getElementById("best").textContent="–®–∏–ª–¥—ç–≥: "+best;
  document.getElementById("over").classList.remove("hidden");
}

/* ---------- Restart ---------- */
function restart(){
  document.getElementById("over").classList.add("hidden");
  document.getElementById("start").classList.remove("hidden");
}
</script>

</body>
</html>
