<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>АЗХУР</title>

<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --text:#eaffff;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
html,body{height:100%}
body{
  background:radial-gradient(circle at top,#2b1055,#000);
  overflow:hidden;
  color:var(--text);
  touch-action:none;
  -webkit-user-select:none;
  user-select:none;
}

#score{
  position:fixed;
  top:env(safe-area-inset-top,14px);
  left:50%;
  transform:translateX(-50%);
  font-size:22px;
  z-index:10;
}

.screen{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(180deg,rgba(0,0,0,.3),rgba(0,0,0,.9));
  z-index:20;
}
.hidden{display:none}

h1{
  font-size:52px;
  letter-spacing:6px;
  background:linear-gradient(90deg,#00ffd5,#ffd700,#ff4d6d);
  -webkit-background-clip:text;
  color:transparent;
  text-shadow:0 0 30px rgba(255,255,255,.35);
}
.tag{opacity:.8;margin-top:10px}

button{
  margin-top:28px;
  padding:14px 38px;
  border:none;
  border-radius:40px;
  font-size:16px;
  font-weight:700;
  background:linear-gradient(90deg,#00ffd5,#ffd700);
  color:#001;
  box-shadow:0 0 30px rgba(0,255,213,.7);
}
button:active{transform:scale(.94)}

canvas{display:block}
</style>
</head>

<body>

<div id="score">0</div>

<div id="start" class="screen">
  <h1>АЗХУР</h1>
  <div class="tag">Нэг товшилт · Нэг амь</div>
  <button onclick="startGame()">ЭХЛЭХ</button>
</div>

<div id="over" class="screen hidden">
  <h1>ТӨГСӨВ</h1>
  <p id="final"></p>
  <p id="best"></p>
  <button onclick="restart()">ДАХИН</button>
</div>

<canvas id="game"></canvas>

<script>
/* ---------- PWA ---------- */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

/* ---------- Canvas ---------- */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize();
addEventListener("resize",resize);
function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}

/* ---------- Game Data ---------- */
const colors=["#00ffd5","#ffd700","#ff4d6d","#4dabff","#c77dff"];
let player,obs,parts,score,speed,alive,timer,shake=0;

/* ---------- Sound ---------- */
const AudioCtx=window.AudioContext||window.webkitAudioContext;
const actx=new AudioCtx();
function beep(freq=400,d=0.08){
  const o=actx.createOscillator();
  const g=actx.createGain();
  o.frequency.value=freq;
  o.connect(g);g.connect(actx.destination);
  g.gain.value=0.12;
  o.start();o.stop(actx.currentTime+d);
}

/* ---------- Init ---------- */
function init(){
  player={x:canvas.width/2,y:canvas.height-120,r:16,dir:1,color:0};
  obs=[];parts=[];
  score=0;
  speed=3;
  alive=true;
}

/* ---------- Start ---------- */
function startGame(){
  document.getElementById("start").classList.add("hidden");
  init();
  timer=setInterval(spawn,550);
  loop();
}

/* ---------- Controls ---------- */
addEventListener("pointerdown",()=>{
  if(!alive)return;
  player.dir*=-1;
  player.color=(player.color+1)%colors.length;
  burst(player.x,player.y);
  beep(600);
  navigator.vibrate?.(15);
});

/* ---------- Spawn ---------- */
function spawn(){
  obs.push({
    x:Math.random()*canvas.width,
    y:-30,
    r:14,
    c:colors[Math.random()*colors.length|0]
  });
}

/* ---------- FX ---------- */
function burst(x,y){
  for(let i=0;i<18;i++){
    parts.push({
      x,y,
      vx:(Math.random()-.5)*7,
      vy:(Math.random()-.5)*7,
      life:35,
      c:colors[Math.random()*colors.length|0]
    });
  }
}

/* ---------- Loop ---------- */
function loop(){
  if(!alive)return;

  ctx.save();
  if(shake>0){
    ctx.translate((Math.random()-.5)*shake,(Math.random()-.5)*shake);
    shake*=0.9;
  }
  ctx.clearRect(-50,-50,canvas.width+100,canvas.height+100);

  player.x+=player.dir*4.6;
  if(player.x<player.r||player.x>canvas.width-player.r)player.dir*=-1;

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle=colors[player.color];
  ctx.shadowBlur=25;
  ctx.shadowColor=colors[player.color];
  ctx.fill();
  ctx.shadowBlur=0;

  for(let o of obs){
    o.y+=speed;
    ctx.beginPath();
    ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
    ctx.fillStyle=o.c;
    ctx.fill();

    const d=Math.hypot(o.x-player.x,o.y-player.y);
    if(d<o.r+player.r){
      end();
      shake=18;
    }
  }

  obs=obs.filter(o=>o.y<canvas.height+40);

  for(let p of parts){
    p.x+=p.vx;p.y+=p.vy;p.life--;
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,3,3);
  }
  parts=parts.filter(p=>p.life>0);

  score++;
  speed+=0.0008;
  document.getElementById("score").textContent=score;

  ctx.restore();
  requestAnimationFrame(loop);
}

/* ---------- End ---------- */
function end(){
  alive=false;
  clearInterval(timer);
  beep(180,.25);
  navigator.vibrate?.([60,40,60]);

  let best=+localStorage.getItem("az_best")||0;
  if(score>best){
    best=score;
    localStorage.setItem("az_best",best);
  }
  document.getElementById("final").textContent="Оноо: "+score;
  document.getElementById("best").textContent="Шилдэг: "+best;
  document.getElementById("over").classList.remove("hidden");
}

function restart(){
  document.getElementById("over").classList.add("hidden");
  startGame();
}
</script>

</body>
</html>
